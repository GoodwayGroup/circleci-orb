description: Push a Docker image to a registry
parameters:
  image:
    description: Name of image to push
    type: string
  registry:
    default: docker.io
    description: |
      Name of registry to use, defaults to docker.io
    type: string
  step-name:
    default: Docker push
    description: 'Specify a custom step name for this command, if desired'
    type: string
  tag-env:
    default: CIRCLE_SHA1
    description: 'Image tag environment variable, defaults to CIRCLE_SHA1'
    type: env_var_name
  additional_tags:
    default: ''
    description: Space seperated names for additional images tags.
    type: string
steps:
  - deploy:
      command: >
        docker push <<parameters.registry>>/<<
        parameters.image>>:${<<parameters.tag-env>>}
      name: <<parameters.step-name>>
  - when:
      condition: <<parameters.additional_tags>> != ''
      steps:
        - run:
            command: |
              for i in  $(echo << parameters.additional_tags >>); do
                docker push <<parameters.registry>>/<< parameters.image>>:$i
              done
            name: <<parameters.step-name>> aditional tags
